        
        async function handleSyncAllToggle(event) {
            const isEnabled = event.target.checked;
            console.log('[Sync All] Toggle changed:', isEnabled);
            
            updateCalendarListVisibility(isEnabled);
            
            try {
                if (window.electronAPI && window.electronAPI.saveSyncAllState) {
                    await window.electronAPI.saveSyncAllState(isEnabled);
                    console.log('[Sync All] State saved to backend');
                } else {
                    localStorage.setItem('syncAllEnabled', isEnabled);
                    console.log('[Sync All] State saved to localStorage (fallback)');
                }
            } catch (error) {
                console.error('[Sync All] Failed to save state:', error);
                localStorage.setItem('syncAllEnabled', isEnabled);
            }
        }
        
        function updateCalendarListVisibility(syncAllEnabled) {
            const calendarsContent = document.getElementById('calendars-content');
            const notionContent = document.getElementById('notion-content');
            
            if (syncAllEnabled) {
                if (calendarsContent) {
                    calendarsContent.classList.add('sync-all-hidden');
                    const calendarSection = calendarsContent.closest('.service-section');
                    if (calendarSection) {
                        calendarSection.classList.add('sync-all-collapsed');
                    }
                }
                if (notionContent) {
                    notionContent.classList.add('sync-all-hidden');
                    const notionSection = notionContent.closest('.service-section');
                    if (notionSection) {
                        notionSection.classList.add('sync-all-collapsed');
                    }
                }
                console.log('[Sync All] Lists and sections hidden');
            } else {
                if (calendarsContent) {
                    calendarsContent.classList.remove('sync-all-hidden');
                    const calendarSection = calendarsContent.closest('.service-section');
                    if (calendarSection) {
                        calendarSection.classList.remove('sync-all-collapsed');
                    }
                }
                if (notionContent) {
                    notionContent.classList.remove('sync-all-hidden');
                    const notionSection = notionContent.closest('.service-section');
                    if (notionSection) {
                        notionSection.classList.remove('sync-all-collapsed');
                    }
                }
                console.log('[Sync All] Lists and sections visible');
            }
        }
        
        async function loadSyncAllState() {
            try {
                let isEnabled = false;
                
                if (window.electronAPI && window.electronAPI.loadSyncAllState) {
                    isEnabled = await window.electronAPI.loadSyncAllState();
                    console.log('[Sync All] State loaded from backend:', isEnabled);
                } else {
                    const stored = localStorage.getItem('syncAllEnabled');
                    isEnabled = stored === 'true';
                    console.log('[Sync All] State loaded from localStorage:', isEnabled);
                }
                
                const checkbox = document.getElementById('sync-all-toggle');
                if (checkbox) {
                    checkbox.checked = isEnabled;
                    updateCalendarListVisibility(isEnabled);
                }
            } catch (error) {
                console.error('[Sync All] Failed to load state:', error);
            }
        }
        
        function initializeSyncAllToggle() {
            const checkbox = document.getElementById('sync-all-toggle');
            if (checkbox) {
                checkbox.addEventListener('change', handleSyncAllToggle);
                console.log('[Sync All] Toggle event listener attached');
                
                loadSyncAllState();
            } else {
                console.error('[Sync All] Toggle checkbox not found');
            }
        }
        
        document.addEventListener('DOMContentLoaded', initializeSyncAllToggle);
    </script>
</body>
</html>