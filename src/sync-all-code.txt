
        // ========== SYNC ALL TOGGLE FUNCTIONALITY ==========
        
        // Chunk 3: Event handler for Sync All toggle
        document.addEventListener('DOMContentLoaded', () => {
            const syncAllToggle = document.getElementById('sync-all-toggle');
            if (syncAllToggle) {
                syncAllToggle.addEventListener('change', async (e) => {
                    const isEnabled = e.target.checked;
                    console.log(`[Sync All] Toggle changed: ${isEnabled}`);
                    
                    // Update status text visibility
                    const statusText = document.querySelector('.sync-all-status');
                    if (statusText) {
                        if (isEnabled) {
                            statusText.classList.add('visible');
                        } else {
                            statusText.classList.remove('visible');
                        }
                    }
                    
                    // Update calendar list visibility with animation
                    updateCalendarListVisibility(isEnabled);
                    
                    // Save state to database
                    await saveSyncAllState(isEnabled);
                });
            }
        });
        
        // Chunk 4: Update Sync All visibility based on plan
        function updateSyncAllVisibility(planData) {
            const syncAllContainer = document.querySelector('.sync-all-container');
            if (!syncAllContainer) return;
            
            // Only show for Ultimate plan users
            if (planData && planData.type === 'ultimate') {
                console.log('[Sync All] Showing toggle for Ultimate plan user');
                syncAllContainer.classList.add('visible');
                
                // Load saved state from database
                loadSyncAllState();
            } else {
                console.log('[Sync All] Hiding toggle (not Ultimate plan)');
                syncAllContainer.classList.remove('visible');
            }
        }
        
        // Chunk 5: Update calendar list visibility with smooth animation
        function updateCalendarListVisibility(syncAllEnabled) {
            const calendarList = document.getElementById('calendar-list');
            if (!calendarList) return;
            
            if (syncAllEnabled) {
                console.log('[Sync All] Hiding calendar list (sync all enabled)');
                // Animate out
                calendarList.style.maxHeight = calendarList.scrollHeight + 'px';
                requestAnimationFrame(() => {
                    calendarList.style.maxHeight = '0';
                    calendarList.style.opacity = '0';
                    calendarList.style.marginTop = '0';
                });
            } else {
                console.log('[Sync All] Showing calendar list (sync all disabled)');
                // Animate in
                calendarList.style.maxHeight = '2000px'; // Large enough for all calendars
                calendarList.style.opacity = '1';
                calendarList.style.marginTop = '20px';
            }
        }
        
        // Chunk 6: Database persistence for toggle state
        async function saveSyncAllState(isEnabled) {
            try {
                if (window.electronAPI && window.electronAPI.saveSyncAllState) {
                    await window.electronAPI.saveSyncAllState(isEnabled);
                    console.log(`[Sync All] State saved: ${isEnabled}`);
                } else {
                    // Fallback to localStorage if electron API not available
                    localStorage.setItem('sync_all_enabled', isEnabled.toString());
                    console.log(`[Sync All] State saved to localStorage: ${isEnabled}`);
                }
            } catch (error) {
                console.error('[Sync All] Error saving state:', error);
            }
        }
        
        async function loadSyncAllState() {
            try {
                let isEnabled = false;
                
                if (window.electronAPI && window.electronAPI.loadSyncAllState) {
                    isEnabled = await window.electronAPI.loadSyncAllState();
                    console.log(`[Sync All] State loaded from DB: ${isEnabled}`);
                } else {
                    // Fallback to localStorage
                    const saved = localStorage.getItem('sync_all_enabled');
                    isEnabled = saved === 'true';
                    console.log(`[Sync All] State loaded from localStorage: ${isEnabled}`);
                }
                
                // Apply the saved state
                const syncAllToggle = document.getElementById('sync-all-toggle');
                if (syncAllToggle) {
                    syncAllToggle.checked = isEnabled;
                    
                    // Update status text
                    const statusText = document.querySelector('.sync-all-status');
                    if (statusText) {
                        if (isEnabled) {
                            statusText.classList.add('visible');
                        } else {
                            statusText.classList.remove('visible');
                        }
                    }
                    
                    // Update calendar list visibility
                    updateCalendarListVisibility(isEnabled);
                }
            } catch (error) {
                console.error('[Sync All] Error loading state:', error);
            }
        }